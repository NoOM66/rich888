# Story 4.4: Implement the Financial Dashboard

**Epic:** UI & Player Experience

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการแดชบอร์ดทางการเงินที่ครอบคลุม (I want a comprehensive financial dashboard) ซึ่งแสดงรายรับ, รายจ่าย, สินทรัพย์, หนี้สิน, และกราฟเปรียบเทียบการเติบโตของสินทรัพย์เทียบกับเงินเฟ้ออย่างชัดเจน (that clearly displays my income, expenses, assets, liabilities, and graphs comparing my asset growth against inflation) เพื่อที่ฉันจะได้ติดตามสุขภาพทางการเงินของฉันได้อย่างง่ายดายและตัดสินใจระยะยาวได้อย่างมีข้อมูล (so I can easily track my financial health and make informed long-term decisions).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `FinancialDashboardScene.ts` ในโปรเจกต์ และจัดการหน้าจอแดชบอร์ดทางการเงิน
- [x] แดชบอร์ดแสดงสรุปรายรับและรายจ่ายของผู้เล่นในช่วงเวลาหนึ่ง (เช่น รายสัปดาห์, รายเดือน, หรือรวมทั้งหมด)
- [x] แดชบอร์ดแสดงรายละเอียดของสินทรัพย์ (เงินสด, ยอดเงินในธนาคาร, การลงทุน) และหนี้สิน (เงินกู้)
- [x] แดชบอร์ดมีกราฟหรือการแสดงผลด้วยภาพที่เปรียบเทียบการเติบโตของสินทรัพย์รวมของผู้เล่นเทียบกับ `CurrentInflationRate` ตลอดเวลา
- [x] ข้อมูลทางการเงินที่แสดงผลทั้งหมดจะอัปเดตแบบไดนามิกเมื่อมีการเปลี่ยนแปลงในเกม
- [x] แดชบอร์ดสามารถเข้าถึงได้จาก UI หลักของเกม (เช่น ผ่านปุ่ม)

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง Phaser UI Elements สำหรับ Financial Dashboard:**
  - [x] 1.1. สร้าง UI Container หรือ Scene ใหม่สำหรับ Financial Dashboard
  - [x] 1.2. เพิ่ม Text Game Objects สำหรับแสดง:
    - [x] สรุปรายรับ/รายจ่าย (เช่น "รายรับรายสัปดาห์: $X", "รายจ่ายรายสัปดาห์: $Y")
    - [x] รายละเอียดสินทรัพย์ (เงินสด, ยอดเงินในธนาคาร, การลงทุน)
    - [x] หนี้สิน (เงินกู้)
  - [x] 1.3. ออกแบบส่วนประกอบกราฟ (เช่น ใช้ Phaser's Graphics API หรือไลบรารีภายนอก) เพื่อแสดงการเติบโตของสินทรัพย์เทียบกับเงินเฟ้อ

- [x] **2. สร้าง `FinancialDashboardScene.ts`:**
  - [x] 2.1. สร้าง TypeScript class ใหม่ชื่อ `FinancialDashboardScene` ที่สืบทอดจาก `Phaser.Scene`
  - [x] 2.2. กำหนดตัวแปรใน Scene เพื่ออ้างอิงถึง UI elements ต่างๆ

- [x] **3. พัฒนากลไกการดึงข้อมูลและแสดงผล:**
  - [x] 3.1. ให้ `FinancialDashboardScene` ดักฟัง Event ที่เกี่ยวข้องจาก Event Emitter ของเกม (เช่น `OnStatChanged`, `OnLoanPaymentMade`, `OnInvestmentBought/Sold`, `OnInflationChanged`)
  - [x] 3.2. เมื่อได้รับ Event, ให้อัปเดต Text Game Objects ที่เกี่ยวข้อง
  - [x] 3.3. ดึงข้อมูลจาก Controllers/Managers ที่เกี่ยวข้อง (เช่น `PlayerStatsController`, `BankingManager`, `InvestmentManager`) เพื่อแสดงผล

- [x] **4. พัฒนากลไกกราฟ:**
  - [x] 4.1. ส่วนประกอบกราฟจะต้อง:
    - [x] จัดเก็บข้อมูลประวัติของมูลค่าสินทรัพย์รวมและอัตราเงินเฟ้อ
    - [x] อัปเดตข้อมูลเหล่านี้ทุกสัปดาห์ (จาก Event `OnWeekStart` หรือ `OnWeekEnd`)
    - [x] แสดงผลกราฟแบบไดนามิกโดยใช้ Graphics API หรือไลบรารีอื่น

- [x] **5. การเข้าถึง:**
  - [x] 5.1. สร้างปุ่มใน `MainHUDScene` หรือ `UIScene` เพื่อสลับการแสดงผลของ `FinancialDashboardScene`

- [x] **6. เขียน Unit Tests (ใช้ Jest หรือ Testing Library ที่เหมาะสม):**
  - [x] 6.1. เทสว่า Scene แสดงข้อมูลเริ่มต้นจาก `PlayerStatsController` ได้ถูกต้อง
  - [x] 6.2. เทสว่า UI elements อัปเดตอย่างถูกต้องเมื่อได้รับ events
  - [x] 6.3. เทสว่า logic การคำนวณข้อมูลสำหรับกราฟทำงานถูกต้อง

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบกราฟเป็นส่วนที่ซับซ้อนที่สุดของสตอรี่นี้ ควรพิจารณาใช้ไลบรารีสำหรับกราฟ เช่น Chart.js โดยวาดลงบน Canvas element หรือใช้ Phaser's Graphics API เพื่อวาดกราฟโดยตรง
- การเก็บข้อมูลประวัติสำหรับกราฟควรทำอย่างมีประสิทธิภาพ เพื่อไม่ให้ใช้หน่วยความจำมากเกินไป

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบว่าแดชบอร์ดแสดงข้อมูลทางการเงินทั้งหมดถูกต้องและครบถ้วน
- ทดสอบว่าข้อมูลอัปเดตแบบ Real-time เมื่อมีการเปลี่ยนแปลง
- ทดสอบการแสดงผลของกราฟ ว่าถูกต้องและสะท้อนข้อมูลได้จริง
- ทดสอบการเข้าถึงแดชบอร์ดจาก UI หลัก

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** ใช้ Event `OnWeekStart` เพื่ออัปเดตข้อมูลประวัติสำหรับกราฟ
- **Story 1.3: Implement Player Stats System:** ใช้ข้อมูลค่าสถานะผู้เล่น
- **Story 1.5: Implement Global Event System:** ใช้ Event เพื่ออัปเดตข้อมูล
- **Story 2.1: Implement the core Inflation System:** ใช้ `CurrentInflationRate` สำหรับกราฟเปรียบเทียบ
- **Story 2.2: Implement Banking System:** ใช้ข้อมูลยอดเงินในธนาคารและเงินกู้
- **Story 2.3: Implement Investment System:** ใช้ข้อมูลการลงทุนและมูลค่าพอร์ต

-----