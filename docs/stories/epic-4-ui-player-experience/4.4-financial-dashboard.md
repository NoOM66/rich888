# Story 4.4: Implement the Financial Dashboard

**Epic:** UI & Player Experience

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการแดชบอร์ดทางการเงินที่ครอบคลุม (I want a comprehensive financial dashboard) ซึ่งแสดงรายรับ, รายจ่าย, สินทรัพย์, หนี้สิน, และกราฟเปรียบเทียบการเติบโตของสินทรัพย์เทียบกับเงินเฟ้ออย่างชัดเจน (that clearly displays my income, expenses, assets, liabilities, and graphs comparing my asset growth against inflation) เพื่อที่ฉันจะได้ติดตามสุขภาพทางการเงินของฉันได้อย่างง่ายดายและตัดสินใจระยะยาวได้อย่างมีข้อมูล (so I can easily track my financial health and make informed long-term decisions).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `FinancialDashboardUI.cs` Script ในโปรเจกต์ และจัดการหน้าจอแดชบอร์ดทางการเงิน
- [ ] แดชบอร์ดแสดงสรุปรายรับและรายจ่ายของผู้เล่นในช่วงเวลาหนึ่ง (เช่น รายสัปดาห์, รายเดือน, หรือรวมทั้งหมด)
- [ ] แดชบอร์ดแสดงรายละเอียดของสินทรัพย์ (เงินสด, ยอดเงินในธนาคาร, การลงทุน) และหนี้สิน (เงินกู้)
- [ ] แดชบอร์ดมีกราฟหรือการแสดงผลด้วยภาพที่เปรียบเทียบการเติบโตของสินทรัพย์รวมของผู้เล่นเทียบกับ `CurrentInflationRate` ตลอดเวลา
- [ ] ข้อมูลทางการเงินที่แสดงผลทั้งหมดจะอัปเดตแบบไดนามิกเมื่อมีการเปลี่ยนแปลงในเกม
- [ ] แดชบอร์ดสามารถเข้าถึงได้จาก UI หลักของเกม (เช่น ผ่านปุ่ม)

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. ออกแบบ UI สำหรับ Financial Dashboard:**
  - [ ] 1.1. สร้าง UI Panel ใหม่สำหรับ Financial Dashboard
  - [ ] 1.2. เพิ่ม Text Elements สำหรับแสดง:
    - [ ] สรุปรายรับ/รายจ่าย (เช่น "รายรับรายสัปดาห์: $X", "รายจ่ายรายสัปดาห์: $Y")
    - [ ] รายละเอียดสินทรัพย์ (เงินสด, ยอดเงินในธนาคาร, การลงทุน)
    - [ ] หนี้สิน (เงินกู้)
  - [ ] 1.3. ออกแบบส่วนประกอบกราฟ (เช่น ใช้ Unity UI Extensions หรือสร้างเอง) เพื่อแสดงการเติบโตของสินทรัพย์เทียบกับเงินเฟ้อ

- [ ] **2. สร้าง FinancialDashboardUI Script:**
  - [ ] 2.1. สร้าง C# Script ใหม่ชื่อ `FinancialDashboardUI.cs` และทำให้เป็น Singleton
  - [ ] 2.2. เพิ่ม `[SerializeField]` fields เพื่อเชื่อมโยงกับ UI Elements ใน Inspector

- [ ] **3. พัฒนากลไกการดึงข้อมูลและแสดงผล:**
  - [ ] 3.1. ให้ `FinancialDashboardUI` ดักฟัง Event ที่เกี่ยวข้อง (เช่น `OnStatChanged`, `OnLoanPaymentMade`, `OnInvestmentBought/Sold`, `OnInflationChanged`)
  - [ ] 3.2. เมื่อได้รับ Event, ให้อัปเดต UI Elements ที่เกี่ยวข้อง
  - [ ] 3.3. ดึงข้อมูลจาก `PlayerStatsController`, `BankingManager`, `InvestmentManager` เพื่อแสดงผล

- [ ] **4. พัฒนากลไกกราฟ:**
  - [ ] 4.1. ส่วนประกอบกราฟจะต้อง:
    - [ ] จัดเก็บข้อมูลประวัติของมูลค่าสินทรัพย์รวมและอัตราเงินเฟ้อ
    - [ ] อัปเดตข้อมูลเหล่านี้ทุกสัปดาห์ (จาก Event `OnWeekStart` หรือ `OnWeekEnd`)
    - [ ] แสดงผลกราฟแบบไดนามิก

- [ ] **5. การเข้าถึง:**
  - [ ] 5.1. สร้างปุ่มใน `MainHUDManager` หรือ `UIManager` เพื่อเปิด/ปิด `FinancialDashboardUI`

- [ ] **6. เขียน Unit Tests (UI Integration Tests):**
  - [ ] 6.1. เทสว่าแดชบอร์ดแสดงค่าเริ่มต้นได้ถูกต้อง
  - [ ] 6.2. เทสว่าข้อมูลทางการเงินทั้งหมดอัปเดตถูกต้องเมื่อค่าพื้นฐานเปลี่ยนแปลง
  - [ ] 6.3. เทสการพล็อตข้อมูลของกราฟและความถูกต้องเทียบกับอัตราเงินเฟ้อ

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบกราฟเป็นส่วนที่ซับซ้อนที่สุดของสตอรี่นี้ ควรพิจารณาใช้ Asset สำเร็จรูป (เช่น Unity UI Extensions) หรือไลบรารีสำหรับกราฟ
- การเก็บข้อมูลประวัติสำหรับกราฟควรทำอย่างมีประสิทธิภาพ เพื่อไม่ให้ใช้หน่วยความจำมากเกินไป

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบว่าแดชบอร์ดแสดงข้อมูลทางการเงินทั้งหมดถูกต้องและครบถ้วน
- ทดสอบว่าข้อมูลอัปเดตแบบ Real-time เมื่อมีการเปลี่ยนแปลง
- ทดสอบการแสดงผลของกราฟ ว่าถูกต้องและสะท้อนข้อมูลได้จริง
- ทดสอบการเข้าถึงแดชบอร์ดจาก UI หลัก

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** ใช้ Event `OnWeekStart` เพื่ออัปเดตข้อมูลประวัติสำหรับกราฟ
- **Story 1.3: Implement Player Stats System:** ใช้ข้อมูลค่าสถานะผู้เล่น
- **Story 1.5: Implement Global Event System:** ใช้ Event เพื่ออัปเดตข้อมูล
- **Story 2.1: Implement the core Inflation System:** ใช้ `CurrentInflationRate` สำหรับกราฟเปรียบเทียบ
- **Story 2.2: Implement Banking System:** ใช้ข้อมูลยอดเงินในธนาคารและเงินกู้
- **Story 2.3: Implement Investment System:** ใช้ข้อมูลการลงทุนและมูลค่าพอร์ต

-----