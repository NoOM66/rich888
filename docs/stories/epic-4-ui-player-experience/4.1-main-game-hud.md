# Story 4.1: Implement Main Game HUD

**Epic:** UI & Player Experience
**Status:** Ready for Review

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการ Heads-Up Display (HUD) ที่ชัดเจนและมองเห็นได้ตลอดเวลา (I want a clear and always-visible Heads-Up Display) ซึ่งแสดงค่าสถานะหลัก, เงินสดปัจจุบัน, สัปดาห์ของเกม, และงบเวลาที่เหลือ (that shows my core stats, current money, the game week, and my remaining time budget) เพื่อที่ฉันจะได้เข้าใจสถานะของตัวละครได้อย่างรวดเร็วและตัดสินใจได้อย่างมีข้อมูล (so I can quickly understand my character's status and make informed decisions).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `MainHUDManager.cs` Script ในโปรเจกต์ และจัดการ HUD หลักของเกม
- [x] HUD แสดงค่าสถานะ Money, Health, Happiness, และ Education อย่างชัดเจน
- [x] HUD แสดงสัปดาห์/วันที่ปัจจุบันของเกม
- [x] HUD แสดงจำนวนเงินสดปัจจุบันของผู้เล่น
- [x] HUD แสดง "งบเวลา" ที่เหลือสำหรับสัปดาห์ปัจจุบัน
- [x] ค่าที่แสดงทั้งหมดบน HUD จะต้องอัปเดตแบบ Real-time เมื่อมีการเปลี่ยนแปลงในเกม
- [x] HUD จะต้องแสดงผลอยู่ตลอดเวลาในระหว่างการเล่นเกม

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง Phaser Text UI Elements สำหรับ HUD:**
  - [x] 1.1. สร้าง Phaser Text objects สำหรับแสดงค่า: Money, Health, Happiness, Education, Current Week, Time Budget
  - [x] 1.2. จัดวางและจัดสไตล์ UI Elements เหล่านี้บนหน้าจอให้เหมาะสม

- [x] **2. `MainScene` ทำหน้าที่เป็น MainHUDManager:**
  - [x] 2.1. `MainScene` จัดการ HUD หลักของเกม
  - [x] 2.2. `MainScene` มี Reference ไปยัง UI Text Elements

- [x] **3. พัฒนากลไกการอัปเดต UI:**
  - [x] 3.1. ให้ `MainHUDManager` ดักฟัง Event จาก Global Event System:
    - [x] `OnStatChanged` (จาก `PlayerStatsController`)
    - [x] `OnWeekStart` (จาก `TurnManager`)
    - [x] `OnWeekEnd` (จาก `TurnManager`)
  - [x] 3.2. เมื่อได้รับ Event `OnStatChanged`, ให้อัปเดต Text ของค่าสถานะที่เกี่ยวข้อง
  - [x] 3.3. เมื่อได้รับ Event `OnWeekStart` หรือ `OnWeekEnd`, ให้อัปเดต Text ของสัปดาห์ปัจจุบันและงบเวลา

- [x] **4. กำหนดค่าเริ่มต้นของ HUD:**
  - [x] 4.1. ในฟังก์ชัน `Start()` ของ `MainHUDManager`, ให้ดึงค่าเริ่มต้นจาก `PlayerStatsController` และ `TurnManager` มาแสดงบน HUD

- [x] **5. เขียน Unit Tests (UI Integration Tests):**
  - [x] 5.1. เทสว่า UI Elements แสดงค่าเริ่มต้นได้ถูกต้อง
  - [x] 5.2. เทสว่า UI Elements อัปเดตค่าได้ถูกต้องเมื่อ Event ต่างๆ ถูกยิงพร้อมค่าใหม่

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การใช้ TextMeshPro จะช่วยให้การแสดงผลข้อความบน UI มีคุณภาพสูงขึ้น
- ควรพิจารณาการใช้ UI Animation เล็กน้อยเมื่อค่าสถานะมีการเปลี่ยนแปลง เพื่อให้ผู้เล่นรับรู้ได้ง่ายขึ้น

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบว่า HUD แสดงผลถูกต้องในทุกสถานะของเกม (MainMenu, GamePlaying, Paused)
- ทดสอบว่าค่าบน HUD อัปเดตถูกต้องเมื่อมีการเปลี่ยนแปลงค่าสถานะ, สัปดาห์, หรืองบเวลา
- ทดสอบการแสดงผลบนหน้าจอขนาดต่างๆ (Resolution)

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.1: Implement GameManager and State Machine:** HUD จะต้องแสดงผลในสถานะ `GamePlaying`
- **Story 1.2: Implement Turn & Time Management System:** HUD จะต้องแสดงสัปดาห์ปัจจุบันและงบเวลาที่เหลือ
- **Story 1.3: Implement Player Stats System:** HUD จะต้องแสดงค่าสถานะของผู้เล่น
- **Story 1.5: Implement Global Event System:** HUD จะต้องดักฟัง Event จากระบบต่างๆ เพื่ออัปเดตข้อมูล

---
## Dev Agent Record
- **Agent Model Used:** Gemini
- **Debug Log References:**
  - Adapted Unity UI tasks to Phaser Text objects in MainScene.
  - MainScene acts as the MainHUDManager.
  - Implemented UI update logic for all HUD elements.
  - Created comprehensive unit tests for MainScene HUD.
- **Completion Notes:**
  - Implemented the Main Game HUD according to the story, adapting Unity concepts to Phaser 3 and TypeScript.
  - The HUD displays core stats, money, week, and time budget, updating in real-time.
  - All core functionalities are complete and unit-tested.
- **File List:**
  - GameDev/Rich/src/main.ts (updated)
  - GameDev/Rich/src/MainScene.test.ts
- **Change Log:**
  - Initial implementation of Main Game HUD.
  - Integration with GameManager, TurnManager, PlayerStatsController, GlobalEventEmitter, InflationManager, and BankingManager.
  - Unit tests for MainScene HUD.
