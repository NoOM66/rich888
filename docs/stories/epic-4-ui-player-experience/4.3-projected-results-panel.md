# Story 4.3: Implement the "Projected Results" Panel

**Epic:** UI & Player Experience
**Status:** Ready for Review

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการ "Projected Results Panel" ที่แสดงการเปลี่ยนแปลงโดยประมาณของค่าสถานะและกำลังซื้อที่แท้จริงของฉันตามกิจกรรมที่วางแผนไว้ (I want a "Projected Results Panel" that dynamically shows the estimated changes to my stats and real purchasing power based on my planned activities) เพื่อที่ฉันจะได้ปรับแผนรายสัปดาห์ให้เหมาะสมและเข้าใจผลกระทบทางการเงินจากภาวะเงินเฟ้อ (so I can optimize my weekly plan and understand the financial impact of inflation).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] "Projected Results Panel" เป็นส่วนประกอบ UI เฉพาะภายใน `WeeklyPlanningUI`
- [x] Panel แสดงการเปลี่ยนแปลงสุทธิโดยประมาณสำหรับ Money, Health, Happiness, และ Education ตามกิจกรรมที่วางแผนไว้สำหรับสัปดาห์ปัจจุบัน
- [x] Panel แสดง "กำลังซื้อที่แท้จริง" โดยประมาณของเงินผู้เล่น หลังจากหักค่าใช้จ่ายที่วางแผนไว้และผลกระทบจากเงินเฟ้อ
- [x] การคาดการณ์ที่แสดงผลจะอัปเดตแบบ Real-time เมื่อมีการเพิ่มหรือลบกิจกรรมออกจากแผนรายสัปดาห์
- [x] การคำนวณผลลัพธ์ที่คาดการณ์จะต้องสะท้อนผลกระทบของกิจกรรมที่วางแผนไว้และอัตราเงินเฟ้อปัจจุบันได้อย่างถูกต้อง

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. ออกแบบ UI สำหรับ Projected Results Panel:**
  - [x] 1.1. สร้าง UI Panel ใหม่ภายใน Canvas ของ `WeeklyPlanningUI`
  - [x] 1.2. เพิ่ม Text Elements สำหรับแสดง:
    - [x] การเปลี่ยนแปลงเงินที่คาดการณ์ (เช่น "+$500", "-$200")
    - [x] การเปลี่ยนแปลง Health, Happiness, Education ที่คาดการณ์
    - [x] "กำลังซื้อที่แท้จริง" ที่คาดการณ์ (เช่น "กำลังซื้อจริง: $1,200")

- [x] **2. เชื่อมต่อกับ WeeklyPlanningUI:**
  - [x] 2.1. ใน `WeeklyPlanningUI.cs`, เพิ่ม `[SerializeField]` fields เพื่อเชื่อมโยงกับ UI Text Elements ของ Projected Results Panel
  - [x] 2.2. ปรับปรุงฟังก์ชัน `UpdateProjectedResults()` (จาก Story 4.2) เพื่อทำการคำนวณและอัปเดต UI Elements ใหม่เหล่านี้

- [x] **3. พัฒนากลไกการคำนวณการคาดการณ์:**
  - [x] 3.1. ฟังก์ชัน `UpdateProjectedResults()` จะต้อง:
    - [x] ดึงค่าสถานะปัจจุบันของผู้เล่นจาก `PlayerStatsController`
    - [x] วนลูปผ่านกิจกรรมที่วางแผนไว้ทั้งหมด
    - [x] จำลองผลกระทบของแต่ละกิจกรรมต่อค่าสถานะ (เงิน, สุขภาพ, ความสุข, การศึกษา, ความเครียด) และเวลา
    - [x] คำนวณการเปลี่ยนแปลงสุทธิสำหรับแต่ละค่าสถานะ
    - [x] คำนวณ "กำลังซื้อที่แท้จริง" ที่คาดการณ์:
      - [x] เริ่มต้นจากเงินสดปัจจุบัน
      - [x] หักค่าใช้จ่ายที่วางแผนไว้ (เช่น ค่าคอร์ส, ค่าเดินทาง)
      - [x] ประยุกต์ใช้ผลกระทบของเงินเฟ้อกับเงินสดที่เหลือ (เช่น `เงินสดที่เหลือ * (1 - InflationManager.CurrentInflationRate)`)
      - [x] (Optional) พิจารณาค่าใช้จ่ายประจำจาก `UpkeepManager` ในการคำนวณนี้ด้วย

- [x] **4. การอัปเดตแบบ Real-time:**
  - [x] 4.1. ตรวจสอบให้แน่ใจว่า `UpdateProjectedResults()` ถูกเรียกใช้ทุกครั้งที่มีการเพิ่มหรือลบกิจกรรมออกจากแผน

- [x] **5. เขียน Unit Tests (UI Integration Tests):**
  - [x] 5.1. เทสว่า Panel อัปเดตถูกต้องเมื่อมีการเพิ่ม/ลบกิจกรรม
  - [x] 5.2. เทสความถูกต้องของการคำนวณการเปลี่ยนแปลงค่าสถานะที่คาดการณ์ สำหรับการรวมกันของกิจกรรมต่างๆ
  - [x] 5.3. เทสความถูกต้องของการคำนวณ "กำลังซื้อที่แท้จริง" โดยเฉพาะกับอัตราเงินเฟ้อและค่าใช้จ่ายที่วางแผนไว้ที่แตกต่างกัน

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การคำนวณ "Projected Real Purchasing Power" เป็นส่วนที่ซับซ้อนที่สุดของสตอรี่นี้ ควรปรึกษา Game Designer เพื่อยืนยันสูตรการคำนวณที่ถูกต้อง
- ควรมี UI ชั่วคราวสำหรับแสดงผลลัพธ์ที่คาดการณ์ เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบว่า Panel แสดงผลลัพธ์ที่คาดการณ์ได้อย่างถูกต้องตามกิจกรรมที่เลือก
- ทดสอบความถูกต้องของการคำนวณการเปลี่ยนแปลงค่าสถานะที่คาดการณ์
- ทดสอบความถูกต้องของการคำนวณ "กำลังซื้อที่แท้จริง" โดยเฉพาะกับอัตราเงินเฟ้อและค่าใช้จ่ายที่วางแผนไว้ที่แตกต่างกัน

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** ใช้ข้อมูลงบเวลา
- **Story 1.3: Implement Player Stats System:** ใช้ค่าสถานะปัจจุบันของผู้เล่น
- **Story 1.5: Implement Global Event System:** ใช้ Event เพื่ออัปเดต Panel
- **Story 2.1: Implement the core Inflation System:** ใช้ `CurrentInflationRate` ในการคำนวณกำลังซื้อที่แท้จริง
- **Story 3.1: Implement Job, Career Path, and Salary System:** ใช้ข้อมูลกิจกรรมงาน
- **Story 3.2: Implement Education System:** ใช้ข้อมูลกิจกรรมการศึกษา
- **Story 3.3: Implement Upkeep System:** (Optional) ใช้ข้อมูลค่าใช้จ่ายประจำในการคำนวณกำลังซื้อที่แท้จริง
- **Story 3.4: Implement Map & Travel System:** ใช้ข้อมูลกิจกรรมการเดินทาง
- **Story 4.2: Implement the Weekly Planning UI:** Panel นี้เป็นส่วนหนึ่งของ UI การวางแผนรายสัปดาห์

---
## Dev Agent Record
- **Agent Model Used:** Gemini
- **Debug Log References:**
  - Enhanced Projected Results Panel UI in WeeklyPlanningScene.ts.
  - Implemented calculation for projected stat changes and real purchasing power.
  - Unit tests for Projected Results Panel.
- **Completion Notes:**
  - Implemented the "Projected Results" Panel according to the story, enhancing the WeeklyPlanningScene.
  - The panel dynamically displays estimated changes to stats and real purchasing power based on planned activities.
  - All core functionalities are complete and unit-tested.
- **File List:**
  - GameDev/Rich/src/WeeklyPlanningScene.ts (updated)
  - GameDev/Rich/src/WeeklyPlanningScene.test.ts (updated)
- **Change Log:**
  - Initial implementation of Projected Results Panel.
  - Integration with WeeklyPlanningScene, PlayerStatsController, and InflationManager.
  - Unit tests for Projected Results Panel.
