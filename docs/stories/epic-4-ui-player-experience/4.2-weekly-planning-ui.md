# Story 4.2: Implement the Weekly Planning UI

**Epic:** UI & Player Experience
**Status:** Ready for Review
**Status:** Ready for Review

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการหน้าจอวางแผนรายสัปดาห์ที่ชัดเจนและโต้ตอบได้ (I want a clear and interactive weekly planning interface) ซึ่งฉันสามารถจัดสรรเวลาให้กับกิจกรรมต่างๆ และเห็นผลลัพธ์ที่คาดการณ์ไว้ (where I can allocate my time to various activities and see the projected outcomes) เพื่อที่ฉันจะได้บริหารจัดการสัปดาห์ของฉันอย่างมีกลยุทธ์และเพิ่มประสิทธิภาพค่าสถานะของฉัน (so I can strategically manage my week and optimize my stats).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `WeeklyPlanningUI.cs` Script ในโปรเจกต์ และจัดการหน้าจอวางแผน
- [x] UI แสดง "งบเวลา" ที่เหลือของผู้เล่นสำหรับสัปดาห์ปัจจุบัน
- [x] UI แสดงรายการกิจกรรมที่สามารถทำได้ (เช่น ทำงาน, เรียน, พักผ่อน, กิจกรรมเฉพาะของงาน/คอร์ส)
- [x] ผู้เล่นสามารถเลือกหรือลากและวางกิจกรรมลงในตาราง/ช่องเวลาของสัปดาห์ได้
- [x] การเลือกกิจกรรมจะหัก "ค่าใช้จ่ายเวลา" ที่เกี่ยวข้องออกจาก "งบเวลา" ที่แสดงผล
- [x] UI มี "Projected Results Panel" ที่อัปเดตแบบไดนามิก เพื่อแสดงการเปลี่ยนแปลงโดยประมาณของ Money, Health, Happiness, และ Education ตามกิจกรรมที่วางแผนไว้
- [x] มีปุ่ม "ยืนยันแผน" หรือ "จบสัปดาห์" เพื่อสรุปแผนและดำเนินเกมไปยังสัปดาห์ถัดไป
- [x] UI จะป้องกันไม่ให้วางแผนกิจกรรม หากผู้เล่นมี "งบเวลา" ไม่เพียงพอ หรือไม่ตรงตามข้อกำหนดเบื้องต้นอื่นๆ (เช่น เงินไม่พอสำหรับคอร์สเรียน)

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง Phaser UI Elements สำหรับหน้าจอวางแผน:**
  - [x] 1.1. สร้าง Phaser Container หรือ Graphics object สำหรับหน้าจอวางแผนรายสัปดาห์
  - [x] 1.2. เพิ่ม Phaser Text objects สำหรับแสดง "งบเวลา" ที่เหลือ
  - [x] 1.3. สร้าง Phaser Text/Image objects (โต้ตอบได้) สำหรับกิจกรรมต่างๆ (ทำงาน, เรียน, พักผ่อน ฯลฯ)
  - [x] 1.4. ออกแบบ "Projected Results Panel" พร้อม Phaser Text objects สำหรับแสดงการเปลี่ยนแปลงค่าสถานะที่คาดการณ์ไว้
  - [x] 1.5. เพิ่มปุ่ม "ยืนยันแผน" หรือ "จบสัปดาห์"

- [x] **2. `WeeklyPlanningScene` ทำหน้าที่เป็น WeeklyPlanningUI Script:**
  - [x] 2.1. `WeeklyPlanningScene` จัดการหน้าจอวางแผนรายสัปดาห์
  - [x] 2.2. `WeeklyPlanningScene` มี Reference ไปยัง UI Elements

- [x] **3. พัฒนากลไกการเลือกกิจกรรม:**
  - [x] 3.1. สร้างฟังก์ชันสำหรับจัดการการเลือกกิจกรรม (เช่น `OnActivityButtonClicked(ActivitySO activity)`)
  - [x] 3.2. เมื่อเลือกกิจกรรม, ให้หัก `timeCost` จาก `plannedTimeBudget` ชั่วคราว และอัปเดต "งบเวลา" ที่แสดงผล
  - [x] 3.3. เก็บกิจกรรมที่เลือกไว้ใน List ชั่วคราว

- [x] **4. พัฒนากลไก "Projected Results Panel":**
  - [x] 4.1. สร้างฟังก์ชัน `private void UpdateProjectedResults()`
  - [x] 4.2. ฟังก์ชันนี้จะจำลองผลกระทบของกิจกรรมที่วางแผนไว้ต่อค่าสถานะปัจจุบันของผู้เล่น
  - [x] 4.3. อัปเดต Text Elements ใน "Projected Results Panel"
  - [x] 4.4. ฟังก์ชันนี้ควรถูกเรียกใช้ทุกครั้งที่มีการเพิ่ม/ลบกิจกรรมจากแผน

- [x] **5. พัฒนากลไกปุ่ม "ยืนยันแผน":**
  - [x] 5.1. เมื่อกดปุ่ม "ยืนยันแผน":
    - [x] วนลูปผ่านกิจกรรมที่วางแผนไว้ทั้งหมด
    - [x] เรียกใช้ Manager ที่เกี่ยวข้อง (เช่น `JobManager.Work()`, `EducationManager.EnrollCourse()`)
    - [x] เรียก `TurnManager.EndCurrentWeek()`
    - [x] เคลียร์ UI การวางแผน

- [x] **6. เชื่อมต่อกับระบบ Event:**
  - [x] 6.1. `WeeklyPlanningUI` ดักฟัง Event `OnWeekStart` เพื่อรีเซ็ต UI
  - [x] 6.2. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnActivityPlanned`, `OnWeekConfirmed`

- [x] **7. เขียน Unit Tests (UI Integration Tests):**
  - [x] 7.1. เทสว่ากิจกรรมสามารถเลือกได้และงบเวลาอัปเดตถูกต้อง
  - [x] 7.2. เทสว่า "Projected Results Panel" อัปเดตถูกต้อง
  - [x] 7.3. เทสว่าปุ่ม "ยืนยันแผน" เรียกใช้ `TurnManager.EndCurrentWeek()` และประยุกต์ใช้ผลกระทบของกิจกรรมได้ถูกต้อง

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบ UI สำหรับการวางแผนควรเน้นความชัดเจนและใช้งานง่าย เพื่อให้ผู้เล่นสามารถวางแผนได้อย่างมีประสิทธิภาพ
- "Projected Results Panel" เป็นฟีเจอร์สำคัญที่ช่วยให้ผู้เล่นตัดสินใจได้ดีขึ้น ควรให้ความสำคัญกับการคำนวณที่ถูกต้องและรวดเร็ว

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการเลือกกิจกรรมและการหักงบเวลาในทุกกรณี (มีเวลาพอ/ไม่พอ)
- ทดสอบว่า "Projected Results Panel" แสดงผลลัพธ์ที่คาดการณ์ได้อย่างถูกต้องตามกิจกรรมที่เลือก
- ทดสอบการทำงานของปุ่ม "ยืนยันแผน" ว่าสามารถดำเนินเกมไปยังสัปดาห์ถัดไปและประยุกต์ใช้ผลกระทบของกิจกรรมได้ถูกต้อง
- ทดสอบการป้องกันการวางแผนกิจกรรมที่ไม่สามารถทำได้ (เช่น เงินไม่พอ, คุณสมบัติไม่ถึง)

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `WeeklyPlanningUI` ต้องใช้ `TurnManager` เพื่อแสดงงบเวลาและจบสัปดาห์
- **Story 1.3: Implement Player Stats System:** `WeeklyPlanningUI` ต้องใช้ `PlayerStatsController` เพื่อแสดงค่าสถานะและคำนวณผลลัพธ์ที่คาดการณ์
- **Story 1.5: Implement Global Event System:** `WeeklyPlanningUI` ต้องใช้ระบบ Event กลางในการส่ง Event ต่างๆ
- **Story 3.1: Implement Job, Career Path, and Salary System:** `WeeklyPlanningUI` จะแสดงกิจกรรมที่เกี่ยวข้องกับงาน
- **Story 3.2: Implement Education System:** `WeeklyPlanningUI` จะแสดงกิจกรรมที่เกี่ยวข้องกับการศึกษา

---
## Dev Agent Record
- **Agent Model Used:** Gemini Gemini
- **Debug Log References:**
  - Created ActivityType.ts enum and BasicActivitiesData.ts.
  - Implemented activity selection UI and logic in WeeklyPlanningScene.ts.
  - Implemented updateProjectedResults method in WeeklyPlanningScene.ts.
  - Implemented confirmPlan method in WeeklyPlanningScene.ts.
  - Implemented event listening and emission for WeeklyPlanningScene.
  - Created comprehensive unit tests for WeeklyPlanningScene.
  - Created WeeklyPlanningScene.ts.
- **Completion Notes:**
  - Implemented the Weekly Planning UI according to the story, adapting Unity concepts to Phaser 3 and TypeScript.
  - The UI allows players to allocate time to activities, see projected outcomes, and confirm their weekly plan.
  - All core functionalities are complete and unit-tested.
  - Implemented the Weekly Planning UI according to the story, adapting Unity concepts to Phaser 3 and TypeScript.
  - The UI allows players to allocate time to activities, see projected outcomes, and confirm their weekly plan.
  - All core functionalities are complete and unit-tested.
- **File List:**
  - GameDev/Rich/src/ActivityType.ts
  - GameDev/Rich/src/BasicActivitiesData.ts
  - GameDev/Rich/src/WeeklyPlanningScene.ts
  - GameDev/Rich/src/WeeklyPlanningScene.test.ts
  - GameDev/Rich/src/main.ts (updated to launch WeeklyPlanningScene)
  - GameDev/Rich/src/ActivityType.ts
  - GameDev/Rich/src/BasicActivitiesData.ts
  - GameDev/Rich/src/WeeklyPlanningScene.ts
  - GameDev/Rich/src/WeeklyPlanningScene.test.ts
  - GameDev/Rich/src/main.ts (updated to launch WeeklyPlanningScene)
  - GameDev/Rich/src/WeeklyPlanningScene.ts
- **Change Log:**
  - Initial implementation of Weekly Planning UI.
  - Integration with TurnManager, PlayerStatsController, GlobalEventEmitter, JobManager, and EducationManager.
  - Unit tests for WeeklyPlanningScene.
  - Initial implementation of Weekly Planning UI.
  - Integration with TurnManager, PlayerStatsController, GlobalEventEmitter, JobManager, and EducationManager.
  - Unit tests for WeeklyPlanningScene.
