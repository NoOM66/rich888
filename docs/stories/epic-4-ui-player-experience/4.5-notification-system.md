# Story 4.5: Implement the Notification System

**Epic:** UI & Player Experience

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการระบบแจ้งเตือนที่ชัดเจนและทันเวลา (I want a clear and timely notification system) ซึ่งจะแจ้งให้ฉันทราบเกี่ยวกับเหตุการณ์สำคัญในเกม เช่น ค่าใช้จ่ายประจำ, การเปลี่ยนแปลงทางเศรษฐกิจ, หรือบทลงโทษ (that informs me about important game events, such as recurring expenses, economic changes, or penalties) เพื่อที่ฉันจะได้รับทราบข้อมูลและตอบสนองได้อย่างเหมาะสม (so I can stay updated and react appropriately).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `NotificationManager.cs` Script ในโปรเจกต์
- [ ] ระบบสามารถแสดงการแจ้งเตือนได้หลายประเภท (เช่น ข้อความแบบ Toast, หรือ Badge ที่แสดงค้าง)
- [ ] การแจ้งเตือนจะถูกเรียกใช้โดย Event เฉพาะในเกม (เช่น `OnUpkeepPaid`, `OnUpkeepMissed`, `OnInflationChanged`, `OnEconomicEventTriggered`)
- [ ] การแจ้งเตือนแต่ละรายการมี `title`, `message`, และ `type` (เช่น Info, Warning, Critical)
- [ ] การแจ้งเตือนแบบ Toast จะปรากฏบนหน้าจอชั่วครู่แล้วจางหายไป
- [ ] การแจ้งเตือนแบบ Badge (ถ้ามีการพัฒนา) จะแสดงค้างอยู่จนกว่าผู้เล่นจะกดรับทราบหรือแก้ไขปัญหา
- [ ] ระบบสามารถจัดการคิวของการแจ้งเตือนได้ โดยจะแสดงผลทีละรายการหากมีหลายรายการเกิดขึ้นพร้อมกัน
- [ ] การแจ้งเตือนมีความชัดเจน, กระชับ, และให้ข้อมูลที่เกี่ยวข้อง

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง NotificationManager Script:**
  - [ ] 1.1. สร้าง C# Script ใหม่ชื่อ `NotificationManager.cs` และทำให้เป็น Singleton

- [ ] **2. ออกแบบ UI สำหรับการแจ้งเตือน:**
  - [ ] 2.1. สร้าง UI Canvas แยกต่างหากสำหรับระบบแจ้งเตือน (เช่น สำหรับ Toast Message)
  - [ ] 2.2. ออกแบบ Prefab สำหรับ Toast Message (เช่น Panel ที่มี Text สำหรับ Title/Message และ Animator สำหรับ Fade-in/Fade-out)
  - [ ] 2.3. (Optional) ออกแบบ UI Element สำหรับ Badge Notification

- [ ] **3. พัฒนากลไก Queue และการแสดงผลการแจ้งเตือน:**
  - [ ] 3.1. ใน `NotificationManager`, สร้าง `Queue<NotificationData>` (โดย `NotificationData` เป็น struct/class ง่ายๆ ที่เก็บ title, message, type)
  - [ ] 3.2. สร้างฟังก์ชัน `public void ShowNotification(string title, string message, NotificationType type)` เพื่อเพิ่มการแจ้งเตือนเข้าคิว
  - [ ] 3.3. พัฒนา Coroutine หรือ Update Loop ที่จะดึงการแจ้งเตือนออกจากคิวและแสดงผลทีละรายการ โดยคำนึงถึงระยะเวลาการแสดงผล

- [ ] **4. เชื่อมต่อกับ Event ในเกม:**
  - [ ] 4.1. ให้ `NotificationManager` ดักฟัง Event ต่างๆ จาก Global Event System (เช่น `OnUpkeepPaid`, `OnUpkeepMissed`, `OnInflationChanged`, `OnEconomicEventTriggered`, `OnLoanPaymentMade`, `OnLoanMissedPayment`)
  - [ ] 4.2. เมื่อได้รับ Event, ให้เรียกใช้ `ShowNotification` พร้อม Title, Message, และ Type ที่เหมาะสม

- [ ] **5. เชื่อมต่อกับระบบ Event:**
  - [ ] 5.1. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnNotificationDisplayed`, `OnNotificationDismissed`

- [ ] **6. เขียน Unit Tests (UI Integration Tests):**
  - [ ] 6.1. เทสว่าการแจ้งเตือนถูกเพิ่มเข้าคิวอย่างถูกต้อง
  - [ ] 6.2. เทสว่าการแจ้งเตือนแสดงผลทีละรายการ
  - [ ] 6.3. เทสว่า Toast Message Fade-in/Fade-out ได้ถูกต้อง
  - [ ] 6.4. เทสว่าการแจ้งเตือนถูกเรียกใช้โดย Event ต่างๆ พร้อมเนื้อหาที่ถูกต้อง

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบ UI ของ Notification ควรเรียบง่ายและไม่รบกวนการเล่นเกมมากเกินไป
- ควรพิจารณาการตั้งค่าให้ผู้เล่นสามารถปิด/เปิดการแจ้งเตือนบางประเภทได้ในอนาคต

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการแจ้งเตือนทุกประเภทว่าแสดงผลถูกต้องตาม Event ที่เกิดขึ้น
- ทดสอบการแสดงผลของ Toast Message (ระยะเวลา, การจางหาย)
- ทดสอบกรณีที่มีการแจ้งเตือนหลายรายการพร้อมกัน ว่ามีการจัดการคิวและแสดงผลทีละรายการ
- ทดสอบการแจ้งเตือนบนหน้าจอขนาดต่างๆ

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.5: Implement Global Event System:** `NotificationManager` ต้องดักฟัง Event จากระบบต่างๆ
- **Story 2.1: Implement the core Inflation System:** จะยิง Event เมื่ออัตราเงินเฟ้อเปลี่ยน
- **Story 2.2: Implement Banking System:** จะยิง Event เมื่อมีการฝาก/ถอน/กู้/ผิดนัดชำระ
- **Story 2.4: Implement Random Economic Events:** จะยิง Event เมื่อมี Event สุ่มเกิดขึ้น
- **Story 3.3: Implement Upkeep System:** จะยิง Event เมื่อมีการจ่าย/ไม่จ่ายค่าใช้จ่ายประจำ

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
