# Story 4.5: Implement the Notification System

**Epic:** UI & Player Experience

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการระบบแจ้งเตือนที่ชัดเจนและทันเวลา (I want a clear and timely notification system) ซึ่งจะแจ้งให้ฉันทราบเกี่ยวกับเหตุการณ์สำคัญในเกม เช่น ค่าใช้จ่ายประจำ, การเปลี่ยนแปลงทางเศรษฐกิจ, หรือบทลงโทษ (that informs me about important game events, such as recurring expenses, economic changes, or penalties) เพื่อที่ฉันจะได้รับทราบข้อมูลและตอบสนองได้อย่างเหมาะสม (so I can stay updated and react appropriately).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `NotificationManager.ts` ในโปรเจกต์
- [x] ระบบสามารถแสดงการแจ้งเตือนแบบ Toast ได้
- [x] การแจ้งเตือนจะถูกเรียกใช้โดย Event เฉพาะในเกม (เช่น `OnUpkeepPaid`, `OnUpkeepMissed`, `OnInflationChanged`)
- [x] การแจ้งเตือนแต่ละรายการมี `title`, `message`, และ `type` (เช่น Info, Warning, Critical)
- [x] การแจ้งเตือนแบบ Toast จะปรากฏบนหน้าจอชั่วครู่แล้วจางหายไปโดยใช้ Phaser's Tween
- [x] ระบบสามารถจัดการคิวของการแจ้งเตือนได้ โดยจะแสดงผลทีละรายการ

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง NotificationManager Class:**
  - [x] 1.1. สร้าง TypeScript class ใหม่ชื่อ `NotificationManager.ts` และทำให้เป็น Singleton
  - [x] 1.2. `NotificationManager` ต้องมี reference ไปยัง Scene ที่จะแสดง UI (เช่น `UIScene`)

- [x] **2. ออกแบบ UI สำหรับการแจ้งเตือน:**
  - [x] 2.1. สร้าง Class ใหม่ `ToastNotification.ts` ที่สืบทอดจาก `Phaser.GameObjects.Container`
  - [x] 2.2. `ToastNotification` จะประกอบด้วย `Rectangle` (สำหรับพื้นหลัง) และ `Text` (สำหรับ Title/Message)
  - [x] 2.3. สร้างฟังก์ชันใน `ToastNotification` เพื่อแสดง animation fade-in/fade-out โดยใช้ `scene.tweens`

- [x] **3. พัฒนากลไก Queue และการแสดงผลการแจ้งเตือน:**
  - [x] 3.1. ใน `NotificationManager`, สร้าง `Queue<NotificationData>` (โดย `NotificationData` เป็น `interface` ที่เก็บ title, message, type)
  - [x] 3.2. สร้างฟังก์ชัน `public showNotification(data: NotificationData)` เพื่อเพิ่มการแจ้งเตือนเข้าคิว
  - [x] 3.3. พัฒนา logic ใน `update` loop หรือใช้ `Phaser.Time.TimerEvent` เพื่อดึงการแจ้งเตือนออกจากคิวและแสดงผลทีละรายการ

- [x] **4. เชื่อมต่อกับ Event ในเกม:**
  - [x] 4.1. ให้ `NotificationManager` ดักฟัง Event ต่างๆ จาก `GlobalEventEmitter`
  - [x] 4.2. เมื่อได้รับ Event, ให้เรียกใช้ `showNotification` พร้อมข้อมูลที่เหมาะสม

- [x] **5. เขียน Unit Tests:**
  - [x] 5.1. เทสว่า `NotificationManager` เพิ่มการแจ้งเตือนเข้าคิวอย่างถูกต้อง
  - [x] 5.2. เทสว่า `NotificationManager` แสดงผลการแจ้งเตือนทีละรายการ
  - [-] 5.3. เทสว่า `ToastNotification` เรียกใช้ `scene.tweens` เพื่อสร้าง animation (ข้ามไปก่อนเนื่องจากความซับซ้อนในการ mock UI)

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบ UI ของ Notification ควรเรียบง่ายและไม่รบกวนการเล่นเกมมากเกินไป
- `NotificationManager` ควรถูกสร้างและจัดการโดย Scene หลัก หรือ UI Scene เพื่อให้แน่ใจว่ามีอยู่ตลอด

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการแจ้งเตือนทุกประเภทว่าแสดงผลถูกต้องตาม Event ที่เกิดขึ้น
- ทดสอบการแสดงผลของ Toast Message (ระยะเวลา, การจางหาย)
- ทดสอบกรณีที่มีการแจ้งเตือนหลายรายการพร้อมกัน ว่ามีการจัดการคิวและแสดงผลทีละรายการ

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.5: Implement Global Event System:** `NotificationManager` ต้องดักฟัง Event จากระบบต่างๆ
- **Story 4.4: Implement the Financial Dashboard:** อาจมีการยิง event จากส่วนนี้ในอนาคต

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
