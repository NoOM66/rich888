# Story 1.1: Implement GameManager and State Machine

**Epic:** Core Systems & Player Foundation

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการให้เกมมีระบบจัดการสถานะเกมที่มั่นคง (I want a stable game state management system) เพื่อให้เกมสามารถสลับฉากและการทำงานระหว่างหน้าจอต่างๆ เช่น เมนูหลัก, หน้าจอการเล่น, และหน้าจอจบเกม ได้อย่างถูกต้องและราบรื่น (so that the game can correctly and smoothly handle transitions between different states like the main menu, gameplay, and game over).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `GameManager` Script และ GameObject อยู่ในเกม และถูกตั้งค่าให้ไม่ถูกทำลายเมื่อเปลี่ยน Scene (Persists across scenes).
- [ ] เมื่อเริ่มเกม, ระบบต้องระบุและเข้าสู่สถานะ `MainMenu` ได้อย่างถูกต้อง
- [ ] สามารถเปลี่ยนสถานะจาก `MainMenu` ไปยัง `GamePlaying` ได้ (เช่น เมื่อกดปุ่ม "Start Game").
- [ ] สามารถเปลี่ยนสถานะจาก `GamePlaying` ไปยัง `GameOver` ได้ (เช่น เมื่อเข้าเงื่อนไขการพ่ายแพ้).
- [ ] ระบบอื่นๆ สามารถเข้าถึงสถานะปัจจุบันของเกม (Current Game State) ได้โดยง่าย เพื่อใช้ในการตัดสินใจทำงาน

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง GameManager Script และ Prefab:**
  - [ ] 1.1. สร้าง C# Script ใหม่ชื่อ `GameManager.cs`
  - [ ] 1.2. เขียนโค้ดให้เป็น Singleton Pattern และใช้ `DontDestroyOnLoad()` เพื่อให้คงอยู่ตลอดการเล่น
  - [ ] 1.3. สร้าง GameObject ว่างๆ, แนบสคริปต์ `GameManager`, และสร้างเป็น Prefab เก็บไว้ที่ `_Project/Prefabs/Core/`

- [ ] **2. กำหนด Game States:**
  - [ ] 2.1. สร้าง `public enum GameState` ภายในไฟล์ `GameManager.cs` หรือไฟล์แยก โดยมีค่าอย่างน้อย: `MainMenu`, `GamePlaying`, `Paused`, `GameOver`
  - [ ] 2.2. ใน `GameManager`, สร้าง Property `public GameState CurrentState { get; private set; }` เพื่อเก็บสถานะปัจจุบันของเกม

- [ ] **3. พัฒนากลไก State Machine:**
  - [ ] 3.1. สร้าง `private void ChangeState(GameState newState)` เพื่อเปลี่ยนสถานะ
  - [ ] 3.2. สร้าง `public event Action<GameState> OnGameStateChanged` และเรียกใช้ใน `ChangeState` เพื่อแจ้งให้ระบบอื่นทราบเมื่อสถานะเปลี่ยนไป
  - [ ] 3.3. สร้างฟังก์ชัน Public สำหรับให้ระบบอื่นเรียกใช้ เช่น `public void StartNewGame()`, `public void PauseGame()`, `public void GoToMainMenu()`, `public void EndGame()`

- [ ] **4. ตั้งค่าสถานะเริ่มต้น:**
  - [ ] 4.1. ในฟังก์ชัน `Start()` ของ `GameManager`, กำหนดให้สถานะเริ่มต้นเป็น `GameState.MainMenu`

- [ ] **5. เขียน Unit Tests (เบื้องต้น):**
  - [ ] 5.1. เขียนเทสเพื่อยืนยันว่า `GameManager` เป็น Singleton จริง
  - [ ] 5.2. เขียนเทสเพื่อยืนยันว่าสถานะเริ่มต้นคือ `MainMenu`
  - [ ] 5.3. เขียนเทสเพื่อยืนยันว่าการเรียกฟังก์ชันเปลี่ยนสถานะสามารถเปลี่ยน `CurrentState` และยิง Event ได้ถูกต้อง

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- *ยังไม่มี*

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ควรทดสอบการเปลี่ยน Scene ไปมาเพื่อให้แน่ใจว่า GameManager ยังคงอยู่และทำงานได้ถูกต้อง
- ตรวจสอบว่า Event `OnGameStateChanged` ถูกส่งออกมาพร้อมกับ State ที่ถูกต้องทุกครั้ง

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- *ยังไม่มี*

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
