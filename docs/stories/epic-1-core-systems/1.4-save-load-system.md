# Story 1.4: Implement Save/Load System

**Epic:** Core Systems & Player Foundation

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการที่จะบันทึกความคืบหน้าของเกมและโหลดขึ้นมาเล่นต่อได้ในภายหลัง (I want to be able to save my game progress and load it later) เพื่อที่ฉันจะได้ไม่ต้องเริ่มต้นใหม่ทั้งหมดทุกครั้งที่เล่น (so I don't have to start over every time I play).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `SaveLoadManager.cs` Script ในโปรเจกต์
- [ ] ผู้เล่นสามารถกดบันทึกเกมได้ (เช่น ผ่านปุ่มในเมนู Pause) และระบบจะสร้างไฟล์เซฟเก็บไว้ในเครื่อง
- [ ] เมื่อเปิดเกม, ระบบสามารถตรวจสอบได้ว่ามีไฟล์เซฟเก่าอยู่หรือไม่
- [ ] หากมีไฟล์เซฟอยู่, ที่หน้าเมนูหลักจะแสดงปุ่ม "Continue" หรือ "เล่นต่อ"
- [ ] การโหลดเกมสามารถคืนค่าสถานะของผู้เล่น (`PlayerData`) และข้อมูลเทิร์นปัจจุบัน (`TurnManager`) ได้อย่างถูกต้อง
- [ ] การบันทึกเกมจะเขียนทับไฟล์เซฟเดิมที่มีอยู่

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง SaveLoadManager Script:**
  - [ ] 1.1. สร้าง C# Script ใหม่ชื่อ `SaveLoadManager.cs` และทำให้เป็น Singleton

- [ ] **2. สร้างคลาสสำหรับเก็บข้อมูลเซฟ:**
  - [ ] 2.1. สร้าง C# Script ใหม่ชื่อ `GameSaveData.cs` (ไม่ต้องสืบทอดจาก MonoBehaviour)
  - [ ] 2.2. คลาสนี้จะเก็บข้อมูลทั้งหมดที่ต้องเซฟ เช่น `public PlayerData playerData;`, `public int currentWeek;`
  - [ ] 2.3. กำหนดให้คลาสเป็น `[System.Serializable]`

- [ ] **3. พัฒนากลไกการบันทึกเกม:**
  - [ ] 3.1. สร้างฟังก์ชัน `public void SaveGame()`
  - [ ] 3.2. ภายในฟังก์ชันนี้ ให้รวบรวมข้อมูลจาก Manager อื่นๆ (เช่น `PlayerStatsController`, `TurnManager`) มาใส่ใน instance ของ `GameSaveData`
  - [ ] 3.3. แปลง instance ของ `GameSaveData` เป็น JSON string
  - [ ] 3.4. บันทึก JSON string ลงเป็นไฟล์โดยใช้ `Application.persistentDataPath`

- [ ] **4. พัฒนากลไกการโหลดเกม:**
  - [ ] 4.1. สร้างฟังก์ชัน `public GameSaveData LoadGame()`
  - [ ] 4.2. ภายในฟังก์ชันนี้ ให้ตรวจสอบว่ามีไฟล์เซฟอยู่หรือไม่
  - [ ] 4.3. ถ้ามี, ให้อ่านไฟล์แล้วแปลง JSON string กลับมาเป็น object ของ `GameSaveData` แล้ว return ค่ากลับไป
  - [ ] 4.4. ถ้าไม่มี, ให้ return `null`

- [ ] **5. เชื่อมต่อกับระบบอื่นๆ:**
  - [ ] 5.1. ใน `GameManager`, ให้เรียก `SaveLoadManager.LoadGame()` ตอนเริ่มเกม เพื่อตรวจสอบและแสดง/ซ่อนปุ่ม "Continue"
  - [ ] 5.2. เมื่อผู้เล่นกด "Continue", `GameManager` จะต้องส่งข้อมูลที่โหลดมาไปให้ Manager อื่นๆ (เช่น `PlayerStatsController.LoadPlayerData(data)`)
  - [ ] 5.3. สร้างปุ่ม "Save Game" ในหน้าจอ Pause Menu เพื่อเรียกใช้ `SaveLoadManager.SaveGame()`

- [ ] **6. เขียน Unit Tests:**
  - [ ] 6.1. เทสว่า `SaveGame` สามารถสร้างไฟล์ได้จริง
  - [ ] 6.2. เทสว่า `LoadGame` สามารถอ่านไฟล์และคืนค่าข้อมูลที่ถูกต้องได้
  - [ ] 6.3. เทสการทำงานทั้งวงจร (Save -> Load -> ตรวจสอบข้อมูล) ว่าข้อมูลตรงกัน

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การจัดการเวอร์ชันของไฟล์เซฟเป็นเรื่องสำคัญ อาจต้องพิจารณาเพิ่ม field `saveVersion` ใน `GameSaveData` เผื่อมีการเปลี่ยนแปลงโครงสร้างข้อมูลในอนาคต
- ควรพิจารณาการเข้ารหัสไฟล์เซฟเบื้องต้นเพื่อป้องกันการแก้ไขโดยผู้เล่นโดยตรง

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการเซฟและโหลดในทุกๆ สถานะของเกม (MainMenu, GamePlaying, Paused)
- ทดสอบการปิดเกมทันทีหลังจากเซฟ แล้วเปิดขึ้นมาใหม่เพื่อโหลด
- ทดสอบกรณีที่ไฟล์เซฟเสียหาย (corrupted) ว่าเกมสามารถจัดการได้หรือไม่ (เช่น แจ้งเตือนผู้เล่น หรือเริ่มเกมใหม่)

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** ต้องดึงข้อมูล `CurrentWeek` มาบันทึก
- **Story 1.3: Implement Player Stats System:** ต้องดึง `PlayerData` มาบันทึก

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
