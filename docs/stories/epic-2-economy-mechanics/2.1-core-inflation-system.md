# Story 2.1: Implement the core Inflation System

**Epic:** Inflation & Economy Mechanics

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการให้เกมมีระบบเงินเฟ้อหลักที่ส่งผลกระทบต่อเศรษฐกิจในเกมอย่างสมจริง (I want the game to have a core inflation system that realistically affects the game's economy) เพื่อให้ฉันได้สัมผัสกับความท้าทายจากมูลค่าเงินที่ลดลงและค่าครองชีพที่สูงขึ้น (so that I can feel the challenge of my money losing value and the rising cost of living).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `InflationManager.cs` Script ในโปรเจกต์ และเป็น Singleton
- [ ] `InflationManager` มีค่า `public float CurrentInflationRate` (เช่น 0.02 สำหรับ 2%) ที่ระบบอื่นสามารถเข้ามาดูได้
- [ ] `InflationManager` มีกลไกในการเปลี่ยนแปลงอัตราเงินเฟ้อเป็นระยะ (เช่น ทุกๆ 4 สัปดาห์)
- [ ] เมื่ออัตราเงินเฟ้อเปลี่ยนแปลง, จะต้องมีการยิง Event `OnInflationChanged` (ผ่าน Global Event System) พร้อมส่งค่าอัตราเงินเฟ้อใหม่ไปด้วย
- [ ] มีระบบที่ดักฟัง Event `OnInflationChanged` เพื่อลดมูลค่าเงินสดที่ผู้เล่นถืออยู่ (Purchasing Power Reduction)
- [ ] ระบบอื่นๆ (เช่น ร้านค้า, ค่าเช่าบ้าน) สามารถเข้าถึง `CurrentInflationRate` เพื่อนำไปปรับราคาสินค้าและบริการของตนเองได้

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง InflationManager Script:**
  - [ ] 1.1. สร้าง C# Script ใหม่ชื่อ `InflationManager.cs` และทำให้เป็น Singleton
  - [ ] 1.2. สร้าง public property `CurrentInflationRate`

- [ ] **2. พัฒนากลไกการเปลี่ยนแปลงเงินเฟ้อ:**
  - [ ] 2.1. ให้ `InflationManager` ดักฟัง Event `OnWeekStart`
  - [ ] 2.2. สร้างตัวนับสัปดาห์ และเมื่อครบตามที่กำหนด (เช่น ทุก 4 สัปดาห์) ให้ทำการสุ่มค่าเงินเฟ้อใหม่
  - [ ] 2.3. การสุ่มค่าให้อยู่ในขอบเขต `minInflationRate` และ `maxInflationRate` ที่กำหนดไว้ใน Inspector ได้

- [ ] **3. เชื่อมต่อกับระบบ Event:**
  - [ ] 3.1. สร้าง `GameEventChannelSO<float>` Asset ใหม่ชื่อ `OnInflationChangedEvent`
  - [ ] 3.2. เมื่อมีการเปลี่ยนแปลงค่าเงินเฟ้อ ให้ `InflationManager` เรียกใช้ `.Raise()` บน Event Channel นี้พร้อมส่งค่าใหม่ไปด้วย

- [ ] **4. พัฒนากลไกการลดมูลค่าเงิน:**
  - [ ] 4.1. ใน `PlayerStatsController` (หรือคลาสที่จัดการเงินโดยเฉพาะ), ให้สร้างฟังก์ชันที่ดักฟัง `OnInflationChangedEvent`
  - [ ] 4.2. เมื่อได้รับ Event, ให้คำนวณและลดมูลค่าของเงินสดที่ผู้เล่นถืออยู่ตามอัตราเงินเฟ้อ (อาจจะลดกำลังซื้อโดยการทำให้ของแพงขึ้นทางอ้อม)

- [ ] **5. เขียน Unit Tests:**
  - [ ] 5.1. เทสว่าอัตราเงินเฟ้อเปลี่ยนแปลงหลังจากครบจำนวนสัปดาห์ที่กำหนด
  - [ ] 5.2. เทสว่าค่าเงินเฟ้อใหม่อยู่ในขอบเขต min/max
  - [ ] 5.3. เทสว่า Event `OnInflationChanged` ถูกยิงพร้อมค่าที่ถูกต้อง

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- กลไกการลดมูลค่าเงิน (ข้อ 4.2) เป็นเรื่องที่ต้องออกแบบให้ดี อาจจะไม่ใช่การลดจำนวนเงินโดยตรง แต่อาจจะเป็นการเพิ่มราคาสินค้าในร้านค้าต่างๆ ซึ่งจะถูกพัฒนาในสตอรี่ถัดๆ ไป ในสตอรี่นี้ให้เน้นที่การสร้างระบบ `InflationManager` และการยิง Event ให้ถูกต้องก่อน
- ควรมี UI ชั่วคราวสำหรับแสดง `CurrentInflationRate` เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ต้องทดสอบโดยการเร่งเวลาในเกม (ผ่าน Cheat/Debug menu) เพื่อดูว่าอัตราเงินเฟ้อเปลี่ยนแปลงตามรอบเวลาที่กำหนดจริง
- ตรวจสอบว่า Event ถูกส่งออกไปให้ระบบอื่นรับรู้ได้จริง

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `InflationManager` ต้องใช้ Event `OnWeekStart` เพื่อนับรอบเวลา
- **Story 1.5: Implement Global Event System:** ต้องใช้ระบบ Event กลางในการส่ง `OnInflationChangedEvent`

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
