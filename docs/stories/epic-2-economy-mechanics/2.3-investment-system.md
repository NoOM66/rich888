# Story 2.3: Implement Investment System

**Epic:** Inflation & Economy Mechanics

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการที่จะสามารถลงทุนเงินของฉันในสินทรัพย์ต่างๆ เช่น ทองคำ, กองทุนรวม, หุ้น, และคริปโตเคอร์เรนซี (I want to be able to invest my money in various assets like Gold, Mutual Funds, Stocks, and Cryptocurrency) เพื่อที่ฉันจะได้พยายามเพิ่มพูนความมั่งคั่งให้เร็วกว่าอัตราเงินเฟ้อและบรรลุความมั่นคงทางการเงิน (so I can try to grow my wealth faster than inflation and achieve financial stability).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `InvestmentManager.cs` Script ในโปรเจกต์
- [ ] เกมมีตัวเลือกการลงทุนหลายประเภท: ทองคำ, กองทุนรวม, หุ้น, และคริปโตเคอร์เรนซี
- [ ] สินทรัพย์แต่ละประเภทมีคุณสมบัติความเสี่ยง/ผลตอบแทนที่แตกต่างกัน (เช่น ทองคำ: ความเสี่ยงต่ำ/ผลตอบแทนต่ำ, คริปโต: ความเสี่ยงสูง/ผลตอบแทนสูง)
- [ ] ผู้เล่นสามารถซื้อและขายหน่วยลงทุนของสินทรัพย์เหล่านี้ได้โดยใช้เงินสด
- [ ] มูลค่าของสินทรัพย์ลงทุนจะผันผวนตามเวลา (เช่น รายสัปดาห์) โดยอิงจากสภาวะตลาดและอัตราเงินเฟ้อ
- [ ] ผู้เล่นสามารถดูมูลค่าปัจจุบันของพอร์ตการลงทุนของตนเองได้
- [ ] ผลตอบแทนจากการลงทุนจะถูกเปรียบเทียบกับ `CurrentInflationRate` เพื่อแสดง "ผลตอบแทนที่แท้จริง"
- [ ] การขายสินทรัพย์ลงทุนจะแปลงกลับมาเป็นเงินสดอย่างถูกต้อง

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง InvestmentManager Script:**
  - [ ] 1.1. สร้าง C# Script ใหม่ชื่อ `InvestmentManager.cs` และทำให้เป็น Singleton

- [ ] **2. สร้าง ScriptableObject สำหรับสินทรัพย์ลงทุน:**
  - [ ] 2.1. สร้าง `InvestmentAssetSO.cs` ที่สืบทอดจาก `ScriptableObject`
  - [ ] 2.2. กำหนด Properties เช่น `assetName`, `description`, `baseVolatility`, `baseReturnRate`
  - [ ] 2.3. สร้าง Asset สำหรับ ทองคำ, กองทุนรวม, หุ้น, คริปโตเคอร์เรนซี

- [ ] **3. ขยาย PlayerData สำหรับการลงทุน:**
  - [ ] 3.1. ใน `PlayerData.cs`, เพิ่ม `public Dictionary<string, float> investmentHoldings;` เพื่อเก็บจำนวนหน่วยที่ผู้เล่นถือครอง (Key: Asset ID/Name, Value: Quantity)

- [ ] **4. พัฒนากลไกซื้อ/ขายสินทรัพย์:**
  - [ ] 4.1. สร้างฟังก์ชัน `public void BuyInvestment(InvestmentAssetSO asset, float quantity)` และ `public void SellInvestment(InvestmentAssetSO asset, float quantity)`
  - [ ] 4.2. ฟังก์ชันเหล่านี้ต้องเรียกใช้ `PlayerStatsController` เพื่อจัดการเงินสด และอัปเดต `investmentHoldings`
  - [ ] 4.3. ตรวจสอบเงื่อนไขเงินสดพอซื้อ/มีสินทรัพย์พอขาย

- [ ] **5. พัฒนากลไกการผันผวนของมูลค่า:**
  - [ ] 5.1. ให้ `InvestmentManager` ดักฟัง Event `OnWeekStart`
  - [ ] 5.2. คำนวณราคาตลาดปัจจุบันของสินทรัพย์แต่ละประเภท โดยอิงจาก `baseReturnRate`, `baseVolatility`, และ `InflationManager.CurrentInflationRate`
  - [ ] 5.3. เก็บราคาตลาดปัจจุบันไว้ใน `Dictionary<string, float> currentMarketPrices`

- [ ] **6. พัฒนาฟังก์ชันคำนวณมูลค่าพอร์ต:**
  - [ ] 6.1. สร้างฟังก์ชัน `public float GetTotalPortfolioValue()` ที่จะคำนวณมูลค่ารวมของสินทรัพย์ทั้งหมดที่ผู้เล่นถือครองอยู่

- [ ] **7. เชื่อมต่อกับระบบ Event:**
  - [ ] 7.1. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnInvestmentBought`, `OnInvestmentSold`, `OnMarketPricesUpdated`

- [ ] **8. เขียน Unit Tests:**
  - [ ] 8.1. เทสกลไกซื้อ/ขาย และกรณีขอบเขต
  - [ ] 8.2. เทสการคำนวณมูลค่าผันผวนของสินทรัพย์
  - [ ] 8.3. เทสการคำนวณมูลค่าพอร์ตการลงทุนรวม

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การจำลองความผันผวนของราคาตลาด (ข้อ 5) เป็นส่วนที่สำคัญและซับซ้อนที่สุดของสตอรี่นี้ ควรเริ่มต้นด้วยโมเดลที่เรียบง่ายก่อนแล้วค่อยปรับปรุงให้สมจริงขึ้น
- ควรมี UI ชั่วคราวสำหรับแสดงราคาปัจจุบันของสินทรัพย์แต่ละประเภท และหน้าจอสำหรับซื้อ/ขาย เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการซื้อ/ขายสินทรัพย์ในทุกกรณี รวมถึงกรณีที่เงินสดไม่พอซื้อ หรือไม่มีสินทรัพย์พอขาย
- ทดสอบการคำนวณมูลค่าพอร์ตการลงทุนรวม ว่าถูกต้องตามราคาตลาดปัจจุบัน
- ทดสอบการผันผวนของราคาตลาด ว่าเป็นไปตามที่คาดหวัง (แม้จะเป็นการสุ่ม)

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `InvestmentManager` ต้องใช้ Event `OnWeekStart` เพื่ออัปเดตราคาตลาด
- **Story 1.3: Implement Player Stats System:** `InvestmentManager` ต้องเรียกใช้ฟังก์ชันใน `PlayerStatsController` เพื่อจัดการเงินสด
- **Story 1.5: Implement Global Event System:** ต้องใช้ระบบ Event กลางในการส่ง Event ต่างๆ
- **Story 2.1: Implement the core Inflation System:** `InvestmentManager` ต้องดึง `CurrentInflationRate` มาใช้ในการคำนวณผลตอบแทนที่แท้จริง

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
