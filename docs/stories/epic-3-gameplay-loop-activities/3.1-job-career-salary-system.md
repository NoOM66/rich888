# Story 3.1: Implement Job, Career Path, and Salary System

**Epic:** Gameplay Loop & Activities
**Status:** Ready for Review

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการที่จะสามารถเลือกอาชีพ, ทำงานเพื่อรับเงินเดือนรายสัปดาห์, และก้าวหน้าในสายอาชีพเพื่อเพิ่มรายได้ (I want to be able to choose a job, work to earn a weekly salary, and progress through a career path to increase my income) เพื่อที่ฉันจะได้บริหารจัดการการเงินและบรรลุเป้าหมายในเกมได้ (so I can manage my finances and achieve my goals in the game).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `JobManager.cs` Script ในโปรเจกต์
- [x] เกมมีชุดของประเภทงานที่กำหนดไว้ล่วงหน้า (เช่น ใช้ ScriptableObject สำหรับแต่ละงาน)
- [x] งานแต่ละประเภทมีคุณสมบัติเช่น `name`, `description`, `baseSalary`, `stressPerWeek`, `educationRequirement`, `promotionRequirements`
- [x] ผู้เล่นสามารถเลือกงานเริ่มต้นได้
- [x] ผู้เล่นได้รับเงินเดือนรายสัปดาห์ตามระดับงานปัจจุบัน
- [x] การทำงานจะใช้ "งบเวลา" และส่งผลต่อค่าสถานะ (เช่น เพิ่มความเครียด, ลดความสุข)
- [x] ผู้เล่นสามารถได้รับการเลื่อนตำแหน่งไปยังระดับงานที่สูงขึ้นได้ หากตรงตามข้อกำหนด (เช่น ระดับการศึกษา, ประสบการณ์)
- [x] การเลื่อนตำแหน่งจะเพิ่มเงินเดือนและอาจเปลี่ยนแปลงผลกระทบต่อค่าสถานะ
- [x] ระบบสามารถจัดการการเปลี่ยนงาน (เช่น การลาออก, การถูกไล่ออก)

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง ScriptableObject สำหรับ Job:**
  - [x] 1.1. สร้าง C# Script `JobSO.cs` ที่สืบทอดจาก `ScriptableObject`
  - [x] 1.2. กำหนด Fields: `jobName`, `description`, `baseSalary`, `stressPerWeek`, `happinessChangePerWeek`, `timeCost`, `educationRequirement`, `promotionEducationRequirement`, `promotionExperienceRequirement`, `JobSO nextJobLevel`
  - [x] 1.3. สร้าง Asset สำหรับ Job ตัวอย่าง 2-3 ระดับ (เช่น "Part-time Worker", "Junior Staff")

- [x] **2. สร้าง JobManager Script:**
  - [x] 2.1. สร้าง C# Script ใหม่ชื่อ `JobManager.cs` และทำให้เป็น Singleton
  - [x] 2.2. เก็บ Reference ไปยัง `CurrentJob` ของผู้เล่น

- [x] **3. ขยาย PlayerData สำหรับข้อมูลงาน:**
  - [x] 3.1. ใน `PlayerData.cs`, เพิ่ม `CurrentJobSO currentJob;` และ `float jobExperience;`

- [x] **4. พัฒนากลไกการเลือกงาน:**
  - [x] 4.1. สร้างฟังก์ชัน `public void SelectJob(JobSO job)` ที่จะกำหนด `CurrentJob` ของผู้เล่น
  - [x] 4.2. ตรวจสอบ `educationRequirement` ก่อนรับงาน

- [x] **5. พัฒนากลไกการทำงานรายสัปดาห์:**
  - [x] 5.1. ให้ `JobManager` ดักฟัง Event `OnWeekStart` จาก `TurnManager`
  - [x] 5.2. ใน `OnWeekStart` handler, หากผู้เล่นมีงาน:
    - [x] เรียก `PlayerStatsController.AddMoney(CurrentJob.baseSalary)`
    - [x] เรียก `PlayerStatsController.ApplyStressChange(CurrentJob.stressPerWeek)`
    - [x] เรียก `PlayerStatsController.ApplyHappinessChange(CurrentJob.happinessChangePerWeek)`
    - [x] เรียก `TurnManager.SpendTime(CurrentJob.timeCost)`

- [x] **6. พัฒนากลไกการเลื่อนตำแหน่ง:**
  - [x] 6.1. สร้างฟังก์ชัน `public bool CanPromote()` เพื่อตรวจสอบว่าผู้เล่นมีคุณสมบัติพอเลื่อนตำแหน่งหรือไม่
  - [x] 6.2. สร้างฟังก์ชัน `public void Promote()` เพื่ออัปเดต `CurrentJob` เป็น `nextJobLevel`

- [x] **7. พัฒนากลไกการเปลี่ยนงาน:**
  - [x] 7.1. สร้างฟังก์ชัน `public void QuitJob()` (กำหนด `CurrentJob` เป็น null)
  - [x] 7.2. (Optional) พิจารณาฟังก์ชัน `public void GetFired()` ที่อาจถูกเรียกโดยระบบอื่น

- [x] **8. เชื่อมต่อกับระบบ Event:**
  - [x] 8.1. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnJobSelected`, `OnSalaryReceived`, `OnPromoted`, `OnJobQuit`

- [x] **9. เขียน Unit Tests:**
  - [x] 9.1. เทสการเลือกงานและการตรวจสอบคุณสมบัติ
  - [x] 9.2. เทสการรับเงินเดือนและการเปลี่ยนแปลงค่าสถานะรายสัปดาห์
  - [x] 9.3. เทสกลไกการเลื่อนตำแหน่ง (ทั้งกรณีที่ผ่านและไม่ผ่านเงื่อนไข)
  - [x] 9.4. เทสการลาออก

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบ `JobSO` ให้ยืดหยุ่นจะช่วยให้เพิ่มสายอาชีพใหม่ๆ ได้ง่ายในอนาคต
- ควรมี UI ชั่วคราวสำหรับแสดงงานปัจจุบัน, เงินเดือน, และปุ่มเลื่อนตำแหน่ง/ลาออก เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการเลือกงานในทุกกรณี (มีคุณสมบัติ/ไม่มีคุณสมบัติ)
- ทดสอบการรับเงินเดือนและการเปลี่ยนแปลงค่าสถานะรายสัปดาห์
- ทดสอบการเลื่อนตำแหน่งในทุกกรณี (ผ่าน/ไม่ผ่านเงื่อนไข)
- ทดสอบการลาออกและการเปลี่ยนงาน

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `JobManager` ต้องใช้ Event `OnWeekStart` เพื่อจ่ายเงินเดือนและปรับค่าสถานะ
- **Story 1.3: Implement Player Stats System:** `JobManager` ต้องเรียกใช้ฟังก์ชันใน `PlayerStatsController` เพื่อจัดการเงินและค่าสถานะ
- **Story 1.5: Implement Global Event System:** ต้องใช้ระบบ Event กลางในการส่ง Event ต่างๆ

---
## Dev Agent Record
- **Agent Model Used:** Gemini
- **Debug Log References:**
  - Created Job.ts interface and JobsData.ts.
  - Created JobManager.ts as a TypeScript Singleton.
  - Added currentJob and jobExperience to PlayerData.ts.
  - Added updateCurrentJob and updateJobExperience methods to PlayerStatsController.ts.
  - Implemented selectJob method in JobManager.ts.
  - Implemented weekly work mechanism in JobManager.ts.
  - Implemented canPromote and promote methods in JobManager.ts.
  - Implemented quitJob method in JobManager.ts.
  - Created comprehensive unit tests for JobManager.ts.
  - Created Job.ts interface and JobsData.ts.
  - Created JobManager.ts as a TypeScript Singleton.
- **Completion Notes:**
  - Implemented the Job, Career Path, and Salary System according to the story, adapting C#/.NET concepts to TypeScript/Phaser.
  - The system allows players to select jobs, earn weekly salaries, and progress through career paths.
  - Player stats and time budget are affected by work.
  - All core functionalities are complete and unit-tested.
- **File List:**
  - GameDev/Rich/src/Job.ts
  - GameDev/Rich/src/JobsData.ts
  - GameDev/Rich/src/JobManager.ts
  - GameDev/Rich/src/JobManager.test.ts
  - GameDev/Rich/src/PlayerData.ts (updated)
  - GameDev/Rich/src/PlayerStatsController.ts (updated)
  - GameDev/Rich/src/Job.ts
  - GameDev/Rich/src/JobsData.ts
  - GameDev/Rich/src/JobManager.ts
- **Change Log:**
  - Initial implementation of Job, Career Path, and Salary System.
  - Integration with PlayerStatsController, GlobalEventEmitter, and TurnManager.
  - Unit tests for JobManager.
