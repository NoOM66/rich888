# Story 3.2: Implement Education System

**Epic:** Gameplay Loop & Activities
**Status:** Ready for Review

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการที่จะสามารถลงทะเบียนเรียนและเรียนจบคอร์สการศึกษาต่างๆ เพื่อเพิ่มค่าสถานะการศึกษาของฉัน (I want to be able to enroll in and complete educational courses to increase my education stat) เพื่อที่ฉันจะได้ปลดล็อกโอกาสในการทำงานที่ดีขึ้นและพัฒนาความสามารถของตัวละคร (so I can unlock better job opportunities and improve my character's capabilities).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [x] มี `EducationManager.cs` Script ในโปรเจกต์
- [x] เกมมีชุดของคอร์สการศึกษาที่กำหนดไว้ล่วงหน้า (เช่น ใช้ ScriptableObject สำหรับแต่ละคอร์ส)
- [x] แต่ละคอร์สมีคุณสมบัติเช่น `name`, `description`, `cost`, `timeRequired` (เวลาที่ใช้เรียน), `educationGain` (ค่าการศึกษาที่ได้รับ), `prerequisiteEducationLevel` (ระดับการศึกษาที่ต้องมีก่อนเรียน)
- [x] ผู้เล่นสามารถลงทะเบียนเรียนคอร์สได้ หากมีคุณสมบัติตรงตามข้อกำหนดและมีเงิน/เวลาเพียงพอ
- [x] การเรียนจบคอร์สจะเพิ่มค่าสถานะการศึกษาของผู้เล่นอย่างถูกต้อง
- [x] การเรียนคอร์สจะใช้ "งบเวลา" และหักเงินค่าเรียน
- [x] ระบบสามารถจัดการการเรียนจบคอร์สได้ (เช่น หลังจากผ่านไปจำนวนสัปดาห์/เทิร์นที่กำหนด)
- [x] ผู้เล่นสามารถดูระดับการศึกษาปัจจุบันและคอร์สที่สามารถเรียนได้

## 3. Tasks / Subtasks (งานย่อย)
- [x] **1. สร้าง ScriptableObject สำหรับ Course:**
  - [x] 1.1. สร้าง C# Script `CourseSO.cs` ที่สืบทอดจาก `ScriptableObject`
  - [x] 1.2. กำหนด Fields: `courseName`, `description`, `cost`, `timeRequired` (เวลาที่ใช้เรียน), `educationGain` (ค่าการศึกษาที่ได้รับ), `prerequisiteEducationLevel` (ระดับการศึกษาที่ต้องมีก่อนเรียน)
  - [x] 1.3. สร้าง Asset สำหรับ Course ตัวอย่าง 2-3 คอร์ส

- [x] **2. สร้าง EducationManager Script:**
  - [x] 2.1. สร้าง C# Script ใหม่ชื่อ `EducationManager.cs` และทำให้เป็น Singleton
  - [x] 2.2. เก็บ Reference ไปยัง `CurrentCourse` ที่ผู้เล่นกำลังเรียนอยู่

- [x] **3. ขยาย PlayerData สำหรับข้อมูลการศึกษา:**
  - [x] 3.1. ใน `PlayerData.cs`, เพิ่ม `CurrentCourseSO currentCourse;` และ `int currentEducationLevel;`

- [x] **4. พัฒนากลไกการลงทะเบียนเรียน:**
  - [x] 4.1. สร้างฟังก์ชัน `public bool EnrollCourse(CourseSO course)`
  - [x] 4.2. ตรวจสอบ `prerequisiteEducationLevel`, เงินสด, และ `TimeBudget`
  - [x] 4.3. หากเงื่อนไขครบถ้วน, หักเงิน, ใช้เวลา, กำหนด `CurrentCourse`, และคืนค่า `true`

- [x] **5. พัฒนากลไกการเรียนจบคอร์ส:**
  - [x] 5.1. ให้ `EducationManager` ดักฟัง Event `OnWeekStart` จาก `TurnManager`
  - [x] 5.2. หากมี `CurrentCourse` ที่กำลังเรียนอยู่, ให้ติดตามความคืบหน้า (เช่น `weeksRemaining`)
  - [x] 5.3. เมื่อเรียนจบ:
    - [x] เรียก `PlayerStatsController.AddEducation(CurrentCourse.educationGain)`
    - [x] เคลียร์ `CurrentCourse`
    - [x] ยิง Event `OnCourseCompleted`

- [x] **6. เชื่อมต่อกับระบบ Event:**
  - [x] 6.1. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnCourseEnrolled`, `OnCourseCompleted`

- [x] **7. เขียน Unit Tests:**
  - [x] 7.1. เทส `EnrollCourse` (ทั้งกรณีที่ผ่านและไม่ผ่านเงื่อนไข)
  - [x] 7.2. เทสกลไกการเรียนจบคอร์ส (การเพิ่มค่าการศึกษา, การเคลียร์คอร์ส)
  - [x] 7.3. เทสการยิง Event

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบ `CourseSO` ให้ยืดหยุ่นจะช่วยให้เพิ่มคอร์สใหม่ๆ ได้ง่ายในอนาคต
- ควรมี UI ชั่วคราวสำหรับแสดงคอร์สที่กำลังเรียนอยู่, ความคืบหน้า, และคอร์สที่สามารถลงทะเบียนได้ เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการลงทะเบียนเรียนในทุกกรณี (มีคุณสมบัติ/ไม่มีคุณสมบัติ, เงินพอ/ไม่พอ, เวลาพอ/ไม่พอ)
- ทดสอบการเรียนจบคอร์สและการเพิ่มค่า Education
- ทดสอบการยกเลิกคอร์ส (ถ้ามี)

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `EducationManager` ต้องใช้ Event `OnWeekStart` เพื่อติดตามความคืบหน้าของคอร์ส
- **Story 1.3: Implement Player Stats System:** `EducationManager` ต้องเรียกใช้ฟังก์ชันใน `PlayerStatsController` เพื่อจัดการเงินและค่า Education
- **Story 1.5: Implement Global Event System:** ต้องใช้ระบบ Event กลางในการส่ง Event ต่างๆ
- **Story 3.1: Implement Job, Career Path, and Salary System:** `JobManager` จะใช้ `currentEducationLevel` ใน `PlayerData` เพื่อตรวจสอบคุณสมบัติการเลื่อนตำแหน่ง

---
## Dev Agent Record
- **Agent Model Used:** Gemini
- **Debug Log References:**
  - Created Course.ts interface and CoursesData.ts.
  - Created EducationManager.ts as a TypeScript Singleton.
  - Added currentCourse and currentEducationLevel to PlayerData.ts.
  - Added updateCurrentCourse and updateCurrentEducationLevel methods to PlayerStatsController.ts.
  - Implemented enrollCourse method in EducationManager.ts.
  - Implemented course completion mechanism in EducationManager.ts.
  - Created comprehensive unit tests for EducationManager.ts.
  - Created Course.ts interface and CoursesData.ts.
  - Created EducationManager.ts as a TypeScript Singleton.
- **Completion Notes:**
  - Implemented the Education System according to the story, adapting C#/.NET concepts to TypeScript/Phaser.
  - The system allows players to enroll in courses, track progress, and gain education.
  - All core functionalities are complete and unit-tested.
- **File List:**
  - GameDev/Rich/src/Course.ts
  - GameDev/Rich/src/CoursesData.ts
  - GameDev/Rich/src/EducationManager.ts
  - GameDev/Rich/src/EducationManager.test.ts
  - GameDev/Rich/src/PlayerData.ts (updated)
  - GameDev/Rich/src/PlayerStatsController.ts (updated)
  - GameDev/Rich/src/Course.ts
  - GameDev/Rich/src/CoursesData.ts
  - GameDev/Rich/src/EducationManager.ts
- **Change Log:**
  - Initial implementation of Education System.
  - Integration with PlayerStatsController, GlobalEventEmitter, and TurnManager.
  - Unit tests for EducationManager.
