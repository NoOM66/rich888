# Story 3.4: Implement Map & Travel System

**Epic:** Gameplay Loop & Activities

## 1. Story
ในฐานะผู้เล่น (As a player), ฉันต้องการที่จะสามารถเดินทางไปยังสถานที่ต่างๆ บนแผนที่ได้ (I want to be able to navigate a map with various locations and travel between them) เพื่อที่ฉันจะได้เข้าถึงกิจกรรมที่แตกต่างกันและบริหารจัดการเวลาของฉันได้อย่างมีประสิทธิภาพ (so I can access different activities and manage my time effectively).

## 2. Acceptance Criteria (เกณฑ์การยอมรับ)
- [ ] มี `MapManager.cs` Script ในโปรเจกต์
- [ ] เกมมีโครงสร้างแผนที่ที่กำหนดไว้ล่วงหน้า (เช่น กราฟของ Node/Location)
- [ ] แต่ละสถานที่ (Location) มีคุณสมบัติเช่น `name`, `description`, `activitiesAvailable` (รายการกิจกรรมที่ทำได้ ณ ที่นั้น)
- [ ] แต่ละเส้นทางระหว่างสถานที่ (Path) มี `travelTimeCost` ที่กำหนดไว้
- [ ] ผู้เล่นสามารถเลือกจุดหมายปลายทางจากตำแหน่งปัจจุบันได้
- [ ] การเดินทางไปยังจุดหมายปลายทางจะใช้ "งบเวลา" จาก `TurnManager`
- [ ] เมื่อเดินทางถึง, ตำแหน่งปัจจุบันของผู้เล่นจะถูกอัปเดต
- [ ] ระบบจะป้องกันการเดินทางหากผู้เล่นมี "งบเวลา" ไม่เพียงพอ
- [ ] UI แสดงแผนที่, ตำแหน่งปัจจุบัน, และจุดหมายปลายทางที่สามารถเดินทางไปได้ พร้อมค่าใช้จ่ายเวลาในการเดินทางอย่างชัดเจน

## 3. Tasks / Subtasks (งานย่อย)
- [ ] **1. สร้าง ScriptableObject สำหรับ Location:**
  - [ ] 1.1. สร้าง C# Script `LocationSO.cs` ที่สืบทอดจาก `ScriptableObject`
  - [ ] 1.2. กำหนด Fields: `locationName`, `description`, `List<ActivitySO> availableActivities` (รายการกิจกรรมที่ทำได้ ณ ที่นั้น)
  - [ ] 1.3. สร้าง Asset สำหรับสถานที่ต่างๆ (เช่น Home, Workplace, Bank, etc.)

- [ ] **2. สร้าง ScriptableObject สำหรับ Path:**
  - [ ] 2.1. สร้าง C# Script `PathSO.cs` ที่สืบทอดจาก `ScriptableObject`
  - [ ] 2.2. กำหนด Fields: `LocationSO fromLocation`, `LocationSO toLocation`, `float travelTimeCost`
  - [ ] 2.3. สร้าง Asset สำหรับเส้นทางระหว่างสถานที่ต่างๆ

- [ ] **3. สร้าง MapManager Script:**
  - [ ] 3.1. สร้าง C# Script ใหม่ชื่อ `MapManager.cs` และทำให้เป็น Singleton
  - [ ] 3.2. เก็บ Reference ไปยัง `CurrentLocation` ของผู้เล่น
  - [ ] 3.3. เก็บ List ของ `LocationSO` และ `PathSO` ทั้งหมดเพื่อสร้างกราฟแผนที่

- [ ] **4. ขยาย PlayerData สำหรับข้อมูลตำแหน่ง:**
  - [ ] 4.1. ใน `PlayerData.cs`, เพิ่ม `LocationSO currentLocation;`

- [ ] **5. พัฒนากลไกการเดินทาง:**
  - [ ] 5.1. สร้างฟังก์ชัน `public bool TryTravelTo(LocationSO destination)`
  - [ ] 5.2. ตรวจสอบว่ามีเส้นทางที่ถูกต้องจาก `CurrentLocation` ไปยัง `destination` หรือไม่
  - [ ] 5.3. ตรวจสอบว่า `TurnManager.TimeBudget` เพียงพอสำหรับ `travelTimeCost` หรือไม่
  - [ ] 5.4. หากเงื่อนไขครบถ้วน:
    - [ ] หักเวลาจาก `TurnManager`
    - [ ] อัปเดต `CurrentLocation` ของผู้เล่น
    - [ ] ยิง Event `OnTravelCompleted`
    - [ ] คืนค่า `true`
  - [ ] 5.5. หากเงื่อนไขไม่ครบถ้วน, คืนค่า `false`

- [ ] **6. เชื่อมต่อกับระบบ Event:**
  - [ ] 6.1. ใช้ Global Event System สำหรับ Event ต่างๆ เช่น `OnTravelStarted`, `OnTravelCompleted`

- [ ] **7. เขียน Unit Tests:**
  - [ ] 7.1. เทส `TryTravelTo` (ทั้งกรณีที่เดินทางได้และเดินทางไม่ได้)
  - [ ] 7.2. เทสการอัปเดต `CurrentLocation`
  - [ ] 7.3. เทสการยิง Event

## 4. Dev Notes (บันทึกสำหรับนักพัฒนา)
- การออกแบบแผนที่แบบกราฟ (Nodes and Paths) จะช่วยให้เพิ่มสถานที่และเส้นทางใหม่ๆ ได้ง่ายในอนาคต
- ควรมี UI ชั่วคราวสำหรับแสดงแผนที่และปุ่มเดินทาง เพื่อใช้ในการดีบัก

## 5. QA / Testing Notes (บันทึกสำหรับ QA และการทดสอบ)
- ทดสอบการเดินทางระหว่างสถานที่ต่างๆ ในทุกกรณี (มีเส้นทาง/ไม่มีเส้นทาง, เวลาพอ/ไม่พอ)
- ทดสอบการอัปเดตตำแหน่งปัจจุบันของผู้เล่น
- ทดสอบการยิง Event เมื่อเดินทางสำเร็จ

## 6. Dependencies (สตอรี่ที่เกี่ยวข้อง)
- **Story 1.2: Implement Turn & Time Management System:** `MapManager` ต้องใช้ `TurnManager` เพื่อหักเวลาเดินทาง
- **Story 1.3: Implement Player Stats System:** `MapManager` ต้องเรียกใช้ฟังก์ชันใน `PlayerStatsController` เพื่อจัดการค่าสถานะ (ถ้าการเดินทางมีผลต่อค่าสถานะ)
- **Story 1.5: Implement Global Event System:** ต้องใช้ระบบ Event กลางในการส่ง Event ต่างๆ

---
## Dev Agent Record
- **Agent Model Used:**
- **Debug Log References:**
- **Completion Notes:**
- **File List:**
- **Change Log:**
